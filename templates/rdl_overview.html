{% extends "streamlined_base.html" %}

{% block title %}Research Data Lifecycle Overview - PRISM | MaLDReTH II RDA{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row mb-4">
        <div class="col-12">
            <h1 class="display-4 text-primary mb-3">
                <i class="fas fa-project-diagram me-3"></i>Research Data Lifecycle Overview
            </h1>
            <p class="lead text-muted">
                Explore the 12 stages of the MaLDReTH Research Data Lifecycle model developed by the RDA Working Group. 
                This comprehensive framework maps digital research tools across different phases to support FAIR data practices 
                and improved interoperability within the Global Open Research Commons (GORC) initiative.
            </p>
        </div>
    </div>

    <!-- Quick Stats -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card bg-primary text-white">
                <div class="card-body text-center">
                    <h3 class="card-title">{{ stages|length }}</h3>
                    <p class="card-text">Lifecycle Stages</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-success text-white">
                <div class="card-body text-center">
                    <h3 class="card-title">{{ stage_stats.values() | map(attribute='total_interactions') | sum }}</h3>
                    <p class="card-text">Total Interactions</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-info text-white">
                <div class="card-body text-center">
                    <h3 class="card-title">{{ stage_stats.values() | map(attribute='tool_count') | sum }}</h3>
                    <p class="card-text">Tools Catalogued</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-warning text-white">
                <div class="card-body text-center">
                    <h3 class="card-title">12</h3>
                    <p class="card-text">RDL Phases</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Lifecycle Stages -->
    <div class="row">
        <div class="col-12">
            <h2 class="mb-4">MaLDReTH Research Data Lifecycle Stages</h2>
            
            <div class="row">
                {% for stage in stages %}
                <div class="col-lg-4 col-md-6 mb-4">
                    <div class="card h-100 border-0 shadow-sm">
                        <div class="card-header" style="background-color: {{ stage.color or '#007bff' }}10; border-bottom: 2px solid {{ stage.color or '#007bff' }};">
                            <div class="d-flex justify-content-between align-items-center">
                                <h5 class="mb-0 fw-bold" style="color: {{ stage.color or '#007bff' }};">
                                    {{ loop.index }}. {{ stage.name }}
                                </h5>
                                <span class="badge rounded-pill" style="background-color: {{ stage.color or '#007bff' }};">
                                    Phase {{ stage.position + 1 }}
                                </span>
                            </div>
                        </div>
                        <div class="card-body">
                            <p class="card-text text-muted">{{ stage.description or "Description will be added as the system develops." }}</p>
                            
                            <!-- Stage Statistics -->
                            {% if stage.id in stage_stats %}
                            <div class="row text-center mt-3 mb-3">
                                <div class="col-4">
                                    <small class="text-muted d-block">Tools</small>
                                    <strong class="text-primary">{{ stage_stats[stage.id].tool_count }}</strong>
                                </div>
                                <div class="col-4">
                                    <small class="text-muted d-block">Interactions</small>
                                    <strong class="text-success">{{ stage_stats[stage.id].total_interactions }}</strong>
                                </div>
                                <div class="col-4">
                                    <small class="text-muted d-block">Categories</small>
                                    <strong class="text-info">{{ stage_stats[stage.id].category_count }}</strong>
                                </div>
                            </div>

                            <!-- Featured Tools -->
                            {% if stage_stats[stage.id].tools %}
                            <div class="mt-3">
                                <h6 class="text-muted mb-2">
                                    <i class="fas fa-tools me-1"></i>Featured Tools
                                </h6>
                                <div class="row">
                                    {% for tool in stage_stats[stage.id].tools[:6] %}
                                    <div class="col-6 mb-2">
                                        <a href="{{ url_for('tool_detail', tool_id=tool.id) }}" 
                                           class="btn btn-outline-secondary btn-sm w-100 text-start" 
                                           style="font-size: 0.75rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                                            {% if tool.is_open_source %}
                                                <i class="fas fa-code-branch text-success me-1"></i>
                                            {% else %}
                                                <i class="fas fa-tool text-muted me-1"></i>
                                            {% endif %}
                                            {{ tool.name }}
                                            {% if tool.auto_created is defined and tool.auto_created %}
                                                <i class="fas fa-robot text-info ms-1" title="Auto-created"></i>
                                            {% endif %}
                                        </a>
                                    </div>
                                    {% endfor %}
                                </div>
                                {% if stage_stats[stage.id].has_more_tools %}
                                <div class="text-center mt-2">
                                    <a href="{{ url_for('view_tools') }}?stage={{ stage.id }}" 
                                       class="btn btn-link btn-sm text-decoration-none">
                                        <i class="fas fa-plus me-1"></i>View all {{ stage_stats[stage.id].tool_count }} tools
                                    </a>
                                </div>
                                {% endif %}
                            </div>
                            {% else %}
                            <div class="text-center mt-3 py-3">
                                <i class="fas fa-plus-circle text-muted mb-2" style="font-size: 2rem;"></i>
                                <p class="text-muted small mb-2">No tools catalogued yet</p>
                                <a href="{{ url_for('add_tool') }}" class="btn btn-outline-primary btn-sm">
                                    <i class="fas fa-plus me-1"></i>Add First Tool
                                </a>
                            </div>
                            {% endif %}
                            {% endif %}
                        </div>
                        <div class="card-footer bg-light border-0">
                            <div class="d-flex justify-content-between align-items-center">
                                <small class="text-muted">
                                    <i class="fas fa-layer-group me-1"></i>
                                    Stage {{ stage.position + 1 }} of 12
                                </small>
                                <div class="btn-group btn-group-sm" role="group">
                                    <a href="{{ url_for('view_tools') }}?stage={{ stage.id }}" 
                                       class="btn btn-outline-primary btn-sm">
                                        <i class="fas fa-tools me-1"></i>Tools
                                    </a>
                                    <a href="{{ url_for('view_interactions') }}?search={{ stage.name }}" 
                                       class="btn btn-outline-success btn-sm">
                                        <i class="fas fa-exchange-alt me-1"></i>Interactions
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- Development Notice -->
    <div class="row mt-5">
        <div class="col-12">
            <div class="alert alert-info border-0 shadow-sm">
                <div class="d-flex align-items-center">
                    <i class="fas fa-info-circle me-3 fs-4"></i>
                    <div>
                        <h5 class="alert-heading mb-2">Under Development</h5>
                        <p class="mb-0">
                            This RDL Overview page provides a foundational view of the MaLDReTH lifecycle stages. 
                            Future enhancements will include interactive stage exploration, detailed tool mappings, 
                            and advanced filtering capabilities.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation Actions -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="d-flex flex-wrap gap-3 justify-content-center">
                <a href="{{ url_for('rdl_visualization') }}" class="btn btn-primary btn-lg">
                    <i class="fas fa-chart-network me-2"></i>View Visualization
                </a>
                <a href="{{ url_for('view_interactions') }}" class="btn btn-outline-primary btn-lg">
                    <i class="fas fa-list me-2"></i>Browse Interactions
                </a>
                <a href="{{ url_for('add_interaction') }}" class="btn btn-outline-success btn-lg">
                    <i class="fas fa-plus me-2"></i>Add Interaction
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}