{% extends "streamlined_base.html" %}

{% block title %}PRISM - Platform for Research Infrastructure Synergy Mapping{% endblock %}

{% block content %}
<!-- Hero Section -->
<div class="hero-section">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 mx-auto text-center">
                <h1 class="display-4 fw-bold mb-4">
                    <i class="fas fa-project-diagram me-3"></i>
                    PRISM
                </h1>
                <h2 class="h4 text-light mb-3">Platform for Research Infrastructure Synergy Mapping</h2>
                <p class="lead mb-4">
                    An output of <strong>MaLDReTH II</strong> (Mapping the Landscape of Digital Research Tools Harmonised), 
                    a Research Data Alliance Working Group initiative. PRISM enables systematic mapping and collection 
                    of infrastructure interactions across the research data lifecycle to support FAIR data practices.
                </p>
                <div class="d-flex gap-3 justify-content-center flex-wrap">
                    <a href="{{ url_for('add_interaction') }}" class="btn btn-light btn-lg">
                        <i class="fas fa-plus me-2"></i>Add New Interaction
                    </a>
                    <a href="{{ url_for('view_interactions') }}" class="btn btn-outline-light btn-lg">
                        <i class="fas fa-list me-2"></i>View All Interactions
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Statistics Section -->
<div class="container my-5">
    <div class="row">
        <div class="col-lg-3 col-md-6 mb-4">
            <div class="card text-center card-hover h-100">
                <div class="card-body">
                    <i class="fas fa-database fa-3x text-primary mb-3"></i>
                    <h3 class="fw-bold text-primary">{{ total_interactions or 0 }}</h3>
                    <p class="text-muted mb-0">Total Interactions</p>
                </div>
            </div>
        </div>
        
        <div class="col-lg-3 col-md-6 mb-4">
            <div class="card text-center card-hover h-100">
                <div class="card-body">
                    <i class="fas fa-cogs fa-3x text-success mb-3"></i>
                    <h3 class="fw-bold text-success">{{ total_tools or 0 }}</h3>
                    <p class="text-muted mb-0">Exemplar Tools</p>
                </div>
            </div>
        </div>
        
        <div class="col-lg-3 col-md-6 mb-4">
            <div class="card text-center card-hover h-100">
                <div class="card-body">
                    <i class="fas fa-sitemap fa-3x text-info mb-3"></i>
                    <h3 class="fw-bold text-info">{{ total_stages or 0 }}</h3>
                    <p class="text-muted mb-0">Lifecycle Stages</p>
                </div>
            </div>
        </div>
        
        <div class="col-lg-3 col-md-6 mb-4">
            <div class="card text-center card-hover h-100">
                <div class="card-body">
                    <i class="fas fa-download fa-3x text-warning mb-3"></i>
                    <h3 class="fw-bold text-warning">CSV</h3>
                    <p class="text-muted mb-0">
                        <a href="{{ url_for('export_csv') }}" class="text-decoration-none">
                            Export Data
                        </a>
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- MaLDReTH Stages & Tools -->
<div class="container my-5">
    <div class="row">
        <div class="col-12">
            <h2 class="text-center mb-4">
                <i class="fas fa-recycle me-2"></i>Research Data Lifecycle Stages
            </h2>
            <div class="row">
                {% for stage in stages %}
                <div class="col-lg-4 col-md-6 mb-4">
                    <div class="card h-100 card-hover">
                        <div class="card-header stage-{{ stage.name.lower() }}">
                            <h5 class="mb-0 text-white">{{ stage.name }}</h5>
                        </div>
                        <div class="card-body">
                            <p class="card-text text-muted small">{{ stage.description }}</p>
                            {% for category in stage.tool_categories %}
                            <div class="mt-3">
                                <h6 class="text-primary">{{ category.name }}</h6>
                                <div class="row">
                                    {% for tool in category.tools[:5] %}
                                    <div class="col-12 mb-1">
                                        <a href="{{ url_for('tool_detail', tool_id=tool.id) }}" 
                                           class="btn btn-outline-secondary btn-sm w-100 text-start" 
                                           style="font-size: 0.75rem;">
                                            {% if tool.is_open_source %}
                                                <i class="fas fa-code-branch text-success me-1"></i>
                                            {% else %}
                                                <i class="fas fa-tool text-muted me-1"></i>
                                            {% endif %}
                                            {{ tool.name }}
                                            {% if tool.auto_created is defined and tool.auto_created %}
                                                <i class="fas fa-robot text-info ms-1" title="Auto-created"></i>
                                            {% endif %}
                                        </a>
                                    </div>
                                    {% endfor %}
                                    {% if category.tools.count() > 5 %}
                                    <div class="col-12">
                                        <a href="{{ url_for('view_tools') }}?category={{ category.id }}" 
                                           class="btn btn-link btn-sm text-decoration-none">
                                            <i class="fas fa-plus me-1"></i>{{ category.tools.count() - 5 }} more tools
                                        </a>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<!-- Recent Interactions Section -->
{% if recent_interactions %}
<div class="container my-5">
    <div class="row">
        <div class="col-12">
            <h2 class="text-center mb-4">
                <i class="fas fa-clock me-2"></i>Recent Interactions
            </h2>
            <div class="row">
                {% for interaction in recent_interactions %}
                {% if interaction.source_tool and interaction.target_tool %}
                <div class="col-lg-6 mb-4">
                    <div class="card card-hover h-100">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start mb-3">
                                <h5 class="card-title mb-0">
                                    {{ interaction.interaction_type.replace('_', ' ').title() }}
                                </h5>
                                <span class="badge bg-primary">{{ interaction.lifecycle_stage }}</span>
                            </div>
                            <p class="text-muted small mb-2">
                                <a href="{{ url_for('tool_detail', tool_id=interaction.source_tool.id) }}"
                                   class="text-decoration-none">
                                    <strong>{{ interaction.source_tool.name }}</strong>
                                </a>
                                <i class="fas fa-arrow-right mx-2"></i>
                                <a href="{{ url_for('tool_detail', tool_id=interaction.target_tool.id) }}"
                                   class="text-decoration-none">
                                    <strong>{{ interaction.target_tool.name }}</strong>
                                </a>
                            </p>
                            <p class="card-text">{{ interaction.description[:100] }}{% if interaction.description|length > 100 %}...{% endif %}</p>
                            <div class="d-flex justify-content-between align-items-center">
                                <small class="text-muted">
                                    {{ interaction.submitted_at.strftime('%Y-%m-%d %H:%M') }}
                                </small>
                                <small class="text-muted">
                                    by {{ interaction.submitted_by or 'Anonymous' }}
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}
                {% endfor %}
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- Getting Started Section -->
<div class="container my-5">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-body text-center">
                    <h3 class="card-title">
                        <i class="fas fa-rocket me-2"></i>Getting Started
                    </h3>
                    <p class="card-text">
                        PRISM facilitates the systematic mapping of digital research tools and their interactions across 
                        the research data lifecycle. As an output of the RDA MaLDReTH II Working Group, this platform 
                        supports the development of a comprehensive categorisation schema and autonomous database for 
                        research infrastructure mapping.
                    </p>
                    <p class="small text-muted mb-3">
                        <i class="fas fa-info-circle me-1"></i>
                        Contributing to the RDA Global Open Research Commons (GORC) initiative for improved 
                        interoperability and FAIR workflows.
                    </p>
                    <div class="d-flex gap-3 justify-content-center flex-wrap">
                        <a href="{{ url_for('add_interaction') }}" class="btn btn-primary btn-lg">
                            <i class="fas fa-plus me-2"></i>Add New Interaction
                        </a>
                        <a href="{{ url_for('view_interactions') }}" class="btn btn-outline-primary btn-lg">
                            <i class="fas fa-list me-2"></i>View All Interactions
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- First-Time User Welcome Modal -->
<div class="modal fade" id="welcomeModal" tabindex="-1" aria-labelledby="welcomeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="welcomeModalLabel">
                    <i class="fas fa-rocket me-2"></i>Welcome to PRISM!
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6 class="text-primary">What is PRISM?</h6>
                        <p class="small">
                            <strong>Platform for Research Infrastructure Synergy Mapping</strong> helps you
                            map and understand how digital research tools interact across the research data lifecycle.
                        </p>
                        <h6 class="text-primary mt-3">Why Contribute?</h6>
                        <ul class="small">
                            <li>Build comprehensive tool interaction knowledge</li>
                            <li>Support FAIR data practices</li>
                            <li>Help researchers discover tool integrations</li>
                            <li>Contribute to RDA MaLDReTH II initiative</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h6 class="text-primary">Quick Start Guide</h6>
                        <ol class="small">
                            <li><strong>Read the Guide</strong>: Check out the <a href="{{ url_for('user_guide') }}" target="_blank">User Guide</a> for detailed instructions</li>
                            <li><strong>Explore</strong>: Browse existing interactions and lifecycle stages</li>
                            <li><strong>Learn</strong>: Read the <a href="{{ url_for('glossary') }}" target="_blank">glossary</a> to understand terminology</li>
                            <li><strong>Contribute</strong>: Add interactions you know about</li>
                            <li><strong>Visualize</strong>: Explore the <a href="{{ url_for('radial_visualization') }}" target="_blank">interactive visualizations</a></li>
                        </ol>

                        <div class="alert alert-success border-0 mt-3 mb-0">
                            <small>
                                <i class="fas fa-book-open me-1"></i>
                                <strong>New!</strong> Our comprehensive
                                <a href="{{ url_for('user_guide') }}" class="fw-bold">User Guide</a>
                                walks you through adding and curating interactions step-by-step.
                            </small>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <div class="form-check me-auto">
                    <input class="form-check-input" type="checkbox" id="dontShowAgain">
                    <label class="form-check-label small" for="dontShowAgain">
                        Don't show this again
                    </label>
                </div>
                <a href="{{ url_for('user_guide') }}" class="btn btn-success">
                    <i class="fas fa-book-open me-1"></i>User Guide
                </a>
                <a href="{{ url_for('glossary') }}" class="btn btn-outline-primary">
                    <i class="fas fa-book me-1"></i>Glossary
                </a>
                <a href="{{ url_for('add_interaction') }}" class="btn btn-primary">
                    <i class="fas fa-plus me-1"></i>Add Interaction
                </a>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Check if user has dismissed welcome modal before
    const hasSeenWelcome = localStorage.getItem('prism_welcome_seen');

    if (!hasSeenWelcome) {
        const welcomeModal = new bootstrap.Modal(document.getElementById('welcomeModal'));
        welcomeModal.show();
    }

    // Handle "don't show again" checkbox
    const dontShowCheckbox = document.getElementById('dontShowAgain');
    if (dontShowCheckbox) {
        dontShowCheckbox.addEventListener('change', function() {
            if (this.checked) {
                localStorage.setItem('prism_welcome_seen', 'true');
            } else {
                localStorage.removeItem('prism_welcome_seen');
            }
        });
    }
});
</script>
{% endblock %}
