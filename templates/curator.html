<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MaLDReTH Research Data Lifecycle - Curation Interface</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .header p {
            color: #7f8c8d;
            font-size: 1.1em;
            margin-bottom: 20px;
        }

        .nav-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .tab-button {
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 10px;
            padding: 12px 24px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .tab-button:hover {
            background: rgba(255, 255, 255, 1);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        .tab-button.active {
            background: #3498db;
            color: white;
            transform: translateY(-2px);
        }

        .tab-content {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #2c3e50;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
            background: white;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .btn {
            background: #3498db;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 24px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }

        .btn-secondary {
            background: #95a5a6;
        }

        .btn-secondary:hover {
            background: #7f8c8d;
        }

        .btn-danger {
            background: #e74c3c;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .btn-success {
            background: #27ae60;
        }

        .btn-success:hover {
            background: #229954;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .data-table th,
        .data-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #ecf0f1;
        }

        .data-table th {
            background: #34495e;
            color: white;
            font-weight: 500;
            text-transform: uppercase;
            font-size: 12px;
            letter-spacing: 0.5px;
        }

        .data-table tbody tr:hover {
            background: rgba(52, 152, 219, 0.05);
        }

        .stage-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border-left: 5px solid #3498db;
        }

        .stage-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .stage-title {
            font-size: 1.4em;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .stage-description {
            color: #7f8c8d;
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .category-list {
            margin-top: 15px;
        }

        .category-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 3px solid #27ae60;
        }

        .category-name {
            font-weight: 500;
            color: #2c3e50;
            margin-bottom: 8px;
        }

        .tool-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .tool-tag {
            background: #3498db;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            line-height: 1;
        }

        .close:hover {
            color: #e74c3c;
        }

        .search-box {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 16px;
            margin-bottom: 20px;
            background: white;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .search-box:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .statistics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #3498db;
            margin-bottom: 10px;
        }

        .stat-label {
            color: #7f8c8d;
            font-weight: 500;
            text-transform: uppercase;
            font-size: 12px;
            letter-spacing: 0.5px;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .visualization-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .lifecycle-diagram {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin: 30px 0;
        }

        .lifecycle-stage {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            padding: 20px;
            border-radius: 12px;
            min-width: 150px;
            text-align: center;
            font-weight: 500;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }

        .lifecycle-stage:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 8px 25px rgba(52, 152, 219, 0.4);
        }

        .lifecycle-stage::after {
            content: '→';
            position: absolute;
            right: -30px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 20px;
            color: #3498db;
        }

        .lifecycle-stage:last-child::after {
            content: '';
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header h1 {
                font-size: 2em;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .lifecycle-stage::after {
                content: '↓';
                right: 50%;
                top: 100%;
                transform: translateX(50%);
            }
        }

        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>MaLDReTH Research Data Lifecycle</h1>
            <p>Mapping the Landscape of Digital Research Tools - Curation Interface</p>
            <div class="statistics-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalStages">12</div>
                    <div class="stat-label">Lifecycle Stages</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalCategories">36</div>
                    <div class="stat-label">Tool Categories</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalTools">150</div>
                    <div class="stat-label">Research Tools</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="lastUpdated">Today</div>
                    <div class="stat-label">Last Updated</div>
                </div>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <div class="nav-tabs">
            <button class="tab-button active" onclick="showTab('overview')">Overview</button>
            <button class="tab-button" onclick="showTab('stages')">Manage Stages</button>
            <button class="tab-button" onclick="showTab('categories')">Tool Categories</button>
            <button class="tab-button" onclick="showTab('tools')">Research Tools</button>
            <button class="tab-button" onclick="showTab('visualization')">Visualization</button>
            <button class="tab-button" onclick="showTab('import-export')">Import/Export</button>
        </div>

        <!-- Tab Contents -->
        
        <!-- Overview Tab -->
        <div id="overview" class="tab-content active">
            <h2>Research Data Lifecycle Overview</h2>
            <p>The MaLDReTH (Mapping the Landscape of Digital Research Tools Harmonised) model represents a comprehensive framework for understanding and categorizing research tools across the complete data lifecycle.</p>
            
            <div class="lifecycle-diagram">
                <div class="lifecycle-stage" onclick="selectStage('conceptualise')">Conceptualise</div>
                <div class="lifecycle-stage" onclick="selectStage('plan')">Plan</div>
                <div class="lifecycle-stage" onclick="selectStage('collect')">Collect</div>
                <div class="lifecycle-stage" onclick="selectStage('process')">Process</div>
                <div class="lifecycle-stage" onclick="selectStage('analyse')">Analyse</div>
                <div class="lifecycle-stage" onclick="selectStage('store')">Store</div>
                <div class="lifecycle-stage" onclick="selectStage('publish')">Publish</div>
                <div class="lifecycle-stage" onclick="selectStage('preserve')">Preserve</div>
                <div class="lifecycle-stage" onclick="selectStage('share')">Share</div>
                <div class="lifecycle-stage" onclick="selectStage('access')">Access</div>
                <div class="lifecycle-stage" onclick="selectStage('transform')">Transform</div>
            </div>

            <div id="stageDetails" style="display: none;">
                <div class="stage-card">
                    <div class="stage-title" id="selectedStageTitle"></div>
                    <div class="stage-description" id="selectedStageDescription"></div>
                    <div class="category-list" id="selectedStageCategories"></div>
                </div>
            </div>
        </div>

        <!-- Stages Management Tab -->
        <div id="stages" class="tab-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2>Lifecycle Stages Management</h2>
                <button class="btn btn-success" onclick="openModal('addStageModal')">Add New Stage</button>
            </div>
            
            <input type="text" class="search-box" placeholder="Search stages..." onkeyup="filterStages(this.value)">
            
            <table class="data-table" id="stagesTable">
                <thead>
                    <tr>
                        <th>Order</th>
                        <th>Stage Name</th>
                        <th>Description</th>
                        <th>Tool Categories</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="stagesTableBody">
                    <!-- Dynamic content will be loaded here -->
                </tbody>
            </table>
        </div>

        <!-- Tool Categories Tab -->
        <div id="categories" class="tab-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2>Tool Categories Management</h2>
                <button class="btn btn-success" onclick="openModal('addCategoryModal')">Add New Category</button>
            </div>
            
            <input type="text" class="search-box" placeholder="Search categories..." onkeyup="filterCategories(this.value)">
            
            <table class="data-table" id="categoriesTable">
                <thead>
                    <tr>
                        <th>Category Name</th>
                        <th>Stage</th>
                        <th>Description</th>
                        <th>Tools Count</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="categoriesTableBody">
                    <!-- Dynamic content will be loaded here -->
                </tbody>
            </table>
        </div>

        <!-- Research Tools Tab -->
        <div id="tools" class="tab-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2>Research Tools Management</h2>
                <button class="btn btn-success" onclick="openModal('addToolModal')">Add New Tool</button>
            </div>
            
            <div class="form-row" style="margin-bottom: 20px;">
                <input type="text" class="search-box" placeholder="Search tools..." onkeyup="filterTools(this.value)">
                <select onchange="filterByCategory(this.value)" style="padding: 15px; border-radius: 8px; border: 2px solid #e0e0e0;">
                    <option value="">All Categories</option>
                    <!-- Dynamic options will be loaded here -->
                </select>
            </div>
            
            <table class="data-table" id="toolsTable">
                <thead>
                    <tr>
                        <th>Tool Name</th>
                        <th>Category</th>
                        <th>Stage</th>
                        <th>Provider</th>
                        <th>URL</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="toolsTableBody">
                    <!-- Dynamic content will be loaded here -->
                </tbody>
            </table>
        </div>

        <!-- Visualization Tab -->
        <div id="visualization" class="tab-content">
            <div class="visualization-container">
                <h2>Lifecycle Visualization</h2>
                <p>Interactive visualization of the research data lifecycle and tool relationships</p>
                
                <div style="margin: 20px 0;">
                    <button class="btn" onclick="toggleVisualization('circular')">Circular View</button>
                    <button class="btn btn-secondary" onclick="toggleVisualization('linear')">Linear View</button>
                    <button class="btn btn-secondary" onclick="toggleVisualization('network')">Network View</button>
                </div>
                
                <div id="visualizationArea" style="min-height: 400px; border: 2px dashed #e0e0e0; border-radius: 10px; display: flex; align-items: center; justify-content: center; color: #7f8c8d;">
                    <p>Visualization will be rendered here</p>
                </div>
            </div>
        </div>

        <!-- Import/Export Tab -->
        <div id="import-export" class="tab-content">
            <h2>Data Import/Export</h2>
            
            <div class="form-row">
                <div>
                    <h3>Import Data</h3>
                    <div class="form-group">
                        <label for="importFile">Select file to import:</label>
                        <input type="file" id="importFile" accept=".json,.csv,.xlsx" onchange="handleFileImport(this)">
                    </div>
                    <div class="action-buttons">
                        <button class="btn" onclick="importData()">Import Data</button>
                        <button class="btn btn-secondary" onclick="validateImport()">Validate Import</button>
                    </div>
                </div>
                
                <div>
                    <h3>Export Data</h3>
                    <div class="form-group">
                        <label for="exportFormat">Export format:</label>
                        <select id="exportFormat">
                            <option value="json">JSON</option>
                            <option value="csv">CSV</option>
                            <option value="xlsx">Excel</option>
                        </select>
                    </div>
                    <div class="action-buttons">
                        <button class="btn" onclick="exportData()">Export All Data</button>
                        <button class="btn btn-secondary" onclick="exportStages()">Export Stages Only</button>
                        <button class="btn btn-secondary" onclick="exportTools()">Export Tools Only</button>
                    </div>
                </div>
            </div>
            
            <div style="margin-top: 30px;">
                <h3>Data Backup & Restore</h3>
                <div class="action-buttons">
                    <button class="btn btn-success" onclick="createBackup()">Create Backup</button>
                    <button class="btn btn-secondary" onclick="restoreBackup()">Restore from Backup</button>
                    <button class="btn btn-danger" onclick="resetDatabase()">Reset Database</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    
    <!-- Add Stage Modal -->
    <div id="addStageModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('addStageModal')">&times;</span>
            <h2>Add New Lifecycle Stage</h2>
            <form onsubmit="addStage(event)">
                <div class="form-group">
                    <label for="stageName">Stage Name:</label>
                    <input type="text" id="stageName" required>
                </div>
                <div class="form-group">
                    <label for="stageDescription">Description:</label>
                    <textarea id="stageDescription" required></textarea>
                </div>
                <div class="form-group">
                    <label for="stageOrder">Order:</label>
                    <input type="number" id="stageOrder" min="1" required>
                </div>
                <div class="action-buttons">
                    <button type="submit" class="btn">Add Stage</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('addStageModal')">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Category Modal -->
    <div id="addCategoryModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('addCategoryModal')">&times;</span>
            <h2>Add New Tool Category</h2>
            <form onsubmit="addCategory(event)">
                <div class="form-group">
                    <label for="categoryName">Category Name:</label>
                    <input type="text" id="categoryName" required>
                </div>
                <div class="form-group">
                    <label for="categoryStage">Lifecycle Stage:</label>
                    <select id="categoryStage" required>
                        <!-- Dynamic options will be loaded here -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="categoryDescription">Description:</label>
                    <textarea id="categoryDescription" required></textarea>
                </div>
                <div class="action-buttons">
                    <button type="submit" class="btn">Add Category</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('addCategoryModal')">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Tool Modal -->
    <div id="addToolModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('addToolModal')">&times;</span>
            <h2>Add New Research Tool</h2>
            <form onsubmit="addTool(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label for="toolName">Tool Name:</label>
                        <input type="text" id="toolName" required>
                    </div>
                    <div class="form-group">
                        <label for="toolProvider">Provider:</label>
                        <input type="text" id="toolProvider">
                    </div>
                </div>
                <div class="form-group">
                    <label for="toolCategory">Category:</label>
                    <select id="toolCategory" required>
                        <!-- Dynamic options will be loaded here -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="toolURL">URL:</label>
                    <input type="url" id="toolURL">
                </div>
                <div class="form-group">
                    <label for="toolDescription">Description:</label>
                    <textarea id="toolDescription"></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="toolType">Tool Type:</label>
                        <input type="text" id="toolType">
                    </div>
                    <div class="form-group">
                        <label for="toolSource">Source:</label>
                        <select id="toolSource">
                            <option value="open">Open Source</option>
                            <option value="closed">Closed Source</option>
                            <option value="mixed">Mixed</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="toolInteroperable">Interoperable:</label>
                    <select id="toolInteroperable">
                        <option value="true">Yes</option>
                        <option value="false">No</option>
                        <option value="partial">Partial</option>
                    </select>
                </div>
                <div class="action-buttons">
                    <button type="submit" class="btn">Add Tool</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('addToolModal')">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <script>

                        {
                            id: 2,
                            name: "Diagramming and flowchart",
                            tools: ["Lucidchart", "Draw.io", "Creately"]
                        },
                        {
                            id: 3,
                            name: "Wireframing and prototyping",
                            tools: ["Balsamiq", "Figma"]
                        }
                    ]
                },
                {
                    id: 2,
                    name: "Plan",
                    description: "To establish a structured strategic framework for management of the research project, outlining aims, objectives, methodologies, and resources required for data collection, management and analysis.",
                    order: 2,
                    categories: [
                        {
                            id: 4,
                            name: "Data management planning (DMP)",
                            tools: ["DMP Tool", "DMP Online", "RDMO"]
                        },
                        {
                            id: 5,
                            name: "Project planning",
                            tools: ["Trello", "Asana", "Microsoft Project"]
                        },
                        {
                            id: 6,
                            name: "Combined DMP/project",
                            tools: ["Data Stewardship Wizard", "Redbox research data", "Argos"]
                        }
                    ]
                },
                {
                    id: 3,
                    name: "Collect",
                    description: "To use predefined procedures, methodologies and instruments to acquire and store data that is reliable, fit for purpose and of sufficient quality to test the research hypothesis.",
                    order: 3,
                    categories: [
                        {
                            id: 7,
                            name: "Quantitative data collection tool",
                            tools: ["Open Data Kit", "GBIF", "Cedar WorkBench"]
                        },
                        {
                            id: 8,
                            name: "Qualitative data collection (e.g. Survey tool)",
                            tools: ["Survey Monkey", "Online Surveys", "Zooniverse"]
                        },
                        {
                            id: 9,
                            name: "Harvesting tool (e.g. WebScrapers)",
                            tools: ["Netlytic", "IRODS", "DROID"]
                        }
                    ]
                },
                {
                    id: 4,
                    name: "Process",
                    description: "To make new and existing data analysis-ready through standardised pre-processing, cleaning, reformatting, structuring, filtering, and quality control checks.",
                    order: 4,
                    categories: [
                        {
                            id: 10,
                            name: "Electronic laboratory notebooks (ELNs)",
                            tools: ["elabnext", "E-lab FTW", "RSpace", "Lab Archives"]
                        },
                        {
                            id: 11,
                            name: "Scientific computing across all programming languages",
                            tools: ["Jupyter", "Mathematica", "WebAssembly"]
                        },
                        {
                            id: 12,
                            name: "Metadata Tool",
                            tools: ["CEDAR Workbench (biomedical data)"]
                        }
                    ]
                },
                {
                    id: 5,
                    name: "Analyse",
                    description: "To derive insights, knowledge, and understanding from processed data through iterative exploration and interpretation of experimental or computational results.",
                    order: 5,
                    categories: [
                        {
                            id: 13,
                            name: "Remediation (e.g. motion capture for gait analysis)",
                            tools: ["Track3D"]
                        },
                        {
                            id: 14,
                            name: "Computational methods (e.g. Statistical software)",
                            tools: ["SPSS", "Matlab"]
                        },
                        {
                            id: 15,
                            name: "Computational tools",
                            tools: ["Jupyter", "RStudio", "Eclipse"]
                        }
                    ]
                },
                {
                    id: 6,
                    name: "Store",
                    description: "To record data using technological media appropriate for processing and analysis whilst maintaining data integrity and security.",
                    order: 6,
                    categories: [
                        {
                            id: 16,
                            name: "Data Repository",
                            tools: ["Figshare", "Zenodo", "Dataverse"]
                        },
                        {
                            id: 17,
                            name: "Archive",
                            tools: ["Libsafe"]
                        },
                        {
                            id: 18,
                            name: "Management tool",
                            tools: ["iRODS", "GLOBUS", "Mediaflux"]
                        }
                    ]
                }
            ]
        };

        // Tab management
        function showTab(tabName) {
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => content.classList.remove('active'));
            
            // Remove active class from all tab buttons
            const tabButtons = document.querySelectorAll('.tab-button');
            tabButtons.forEach(button => button.classList.remove('active'));
            
            // Show selected tab content
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked button
            event.target.classList.add('active');
            
            // Load data for the selected tab
            loadTabData(tabName);
        }

        // Load data for specific tabs
        async function loadTabData(tabName) {
            try {
                switch(tabName) {
                    case 'stages':
                        await loadStagesTable();
                        break;
                    case 'categories':
                        await loadCategoriesTable();
                        break;
                    case 'tools':
                        await loadToolsTable();
                        break;
                    case 'visualization':
                        initializeVisualization();
                        break;
                }
            } catch (error) {
                showAlert(`Failed to load ${tabName} data`, 'error');
            }
        }

        // Load stages table
        async function loadStagesTable() {
            const tbody = document.getElementById('stagesTableBody');
            tbody.innerHTML = '<tr><td colspan="5">Loading...</td></tr>';
            
            try {
                const stages = await apiRequest('/stages');
                tbody.innerHTML = '';
                
                stages.forEach(stage => {
                    const row = tbody.insertRow();
                    row.innerHTML = `
                        <td>${stage.order || 'N/A'}</td>
                        <td><strong>${stage.name}</strong></td>
                        <td>${(stage.description || '').substring(0, 100)}${stage.description && stage.description.length > 100 ? '...' : ''}</td>
                        <td>${stage.categories ? stage.categories.length : 0} categories</td>
                        <td>
                            <button class="btn" onclick="editStage(${stage.id})" style="padding: 5px 10px; margin: 2px;">Edit</button>
                            <button class="btn btn-danger" onclick="deleteStage(${stage.id})" style="padding: 5px 10px; margin: 2px;">Delete</button>
                        </td>
                    `;
                });
                
                if (stages.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="5">No stages found</td></tr>';
                }
            } catch (error) {
                tbody.innerHTML = '<tr><td colspan="5">Failed to load stages</td></tr>';
            }
        }

        // Load categories table
        async function loadCategoriesTable() {
            const tbody = document.getElementById('categoriesTableBody');
            tbody.innerHTML = '<tr><td colspan="5">Loading...</td></tr>';
            
            try {
                const categories = await loadCategories();
                tbody.innerHTML = '';
                
                categories.forEach(category => {
                    const row = tbody.insertRow();
                    row.innerHTML = `
                        <td><strong>${category.name}</strong></td>
                        <td>${category.stage_name || 'N/A'}</td>
                        <td>${category.description || 'No description'}</td>
                        <td>${category.tool_count || 0} tools</td>
                        <td>
                            <button class="btn" onclick="editCategory(${category.id})" style="padding: 5px 10px; margin: 2px;">Edit</button>
                            <button class="btn btn-danger" onclick="deleteCategory(${category.id})" style="padding: 5px 10px; margin: 2px;">Delete</button>
                        </td>
                    `;
                });
                
                if (categories.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="5">No categories found</td></tr>';
                }
            } catch (error) {
                tbody.innerHTML = '<tr><td colspan="5">Failed to load categories</td></tr>';
            }
        }

        // Load tools table
        async function loadToolsTable() {
            const tbody = document.getElementById('toolsTableBody');
            tbody.innerHTML = '<tr><td colspan="6">Loading...</td></tr>';
            
            try {
                const tools = await loadTools();
                tbody.innerHTML = '';
                
                tools.forEach(tool => {
                    const row = tbody.insertRow();
                    const url = tool.url ? `<a href="${tool.url}" target="_blank">${tool.url.substring(0, 30)}${tool.url.length > 30 ? '...' : ''}</a>` : 'No URL';
                    
                    row.innerHTML = `
                        <td><strong>${tool.name}</strong></td>
                        <td>${tool.category_name || 'N/A'}</td>
                        <td>${tool.stage_name || 'N/A'}</td>
                        <td>${tool.provider || 'N/A'}</td>
                        <td>${url}</td>
                        <td>
                            <button class="btn" onclick="editTool(${tool.id})" style="padding: 5px 10px; margin: 2px;">Edit</button>
                            <button class="btn btn-danger" onclick="deleteTool(${tool.id})" style="padding: 5px 10px; margin: 2px;">Delete</button>
                        </td>
                    `;
                });
                
                if (tools.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6">No tools found</td></tr>';
                }
            } catch (error) {
                tbody.innerHTML = '<tr><td colspan="6">Failed to load tools</td></tr>';
            }
        }

        // Stage selection for overview
        function selectStage(stageName) {
            const stage = lifecycleData.stages.find(s => s.name.toLowerCase() === stageName.toLowerCase());
            if (!stage) return;
            
            document.getElementById('selectedStageTitle').textContent = stage.name;
            document.getElementById('selectedStageDescription').textContent = stage.description;
            
            const categoriesContainer = document.getElementById('selectedStageCategories');
            categoriesContainer.innerHTML = '';
            
            if (stage.categories && stage.categories.length > 0) {
                stage.categories.forEach(category => {
                    const categoryDiv = document.createElement('div');
                    categoryDiv.className = 'category-item';
                    categoryDiv.innerHTML = `
                        <div class="category-name">${category.name}</div>
                        <div class="tool-tags">
                            ${(category.tools || []).map(tool => `<span class="tool-tag">${tool}</span>`).join('')}
                        </div>
                    `;
                    categoriesContainer.appendChild(categoryDiv);
                });
            } else {
                categoriesContainer.innerHTML = '<p>No categories available for this stage.</p>';
            }
            
            document.getElementById('stageDetails').style.display = 'block';
        }

        // Modal management
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
            
            // Populate dropdowns if needed
            if (modalId === 'addCategoryModal') {
                populateStageDropdown('categoryStage');
            } else if (modalId === 'addToolModal') {
                populateCategoryDropdown('toolCategory');
            }
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Populate dropdowns
        async function populateStageDropdown(selectId) {
            const select = document.getElementById(selectId);
            select.innerHTML = '<option value="">Loading...</option>';
            
            try {
                if (lifecycleData.stages.length === 0) {
                    await loadLifecycleData();
                }
                
                select.innerHTML = '';
                lifecycleData.stages.forEach(stage => {
                    const option = document.createElement('option');
                    option.value = stage.id;
                    option.textContent = stage.name;
                    select.appendChild(option);
                });
            } catch (error) {
                select.innerHTML = '<option value="">Failed to load stages</option>';
            }
        }

        async function populateCategoryDropdown(selectId) {
            const select = document.getElementById(selectId);
            select.innerHTML = '<option value="">Loading...</option>';
            
            try {
                if (lifecycleData.categories.length === 0) {
                    await loadCategories();
                }
                
                select.innerHTML = '';
                lifecycleData.categories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category.id;
                    option.textContent = `${category.stage_name} - ${category.name}`;
                    select.appendChild(option);
                });
            } catch (error) {
                select.innerHTML = '<option value="">Failed to load categories</option>';
            }
        }

        // Form submission handlers
        async function addStage(event) {
            event.preventDefault();
            
            const name = document.getElementById('stageName').value;
            const description = document.getElementById('stageDescription').value;
            const order = parseInt(document.getElementById('stageOrder').value);
            
            try {
                const newStage = await apiRequest('/stages', {
                    method: 'POST',
                    body: JSON.stringify({
                        name: name,
                        description: description,
                        order: order
                    })
                });
                
                closeModal('addStageModal');
                await loadStagesTable();
                showAlert('Stage added successfully!', 'success');
                
                // Reset form
                event.target.reset();
            } catch (error) {
                showAlert(`Failed to add stage: ${error.message}`, 'error');
            }
        }

        async function addCategory(event) {
            event.preventDefault();
            
            const name = document.getElementById('categoryName').value;
            const stageId = parseInt(document.getElementById('categoryStage').value);
            const description = document.getElementById('categoryDescription').value;
            
            try {
                const newCategory = await apiRequest('/categories', {
                    method: 'POST',
                    body: JSON.stringify({
                        name: name,
                        stage_id: stageId,
                        description: description
                    })
                });
                
                closeModal('addCategoryModal');
                await loadCategoriesTable();
                showAlert('Category added successfully!', 'success');
                
                // Reset form
                event.target.reset();
            } catch (error) {
                showAlert(`Failed to add category: ${error.message}`, 'error');
            }
        }

        async function addTool(event) {
            event.preventDefault();
            
            const name = document.getElementById('toolName').value;
            const categoryId = parseInt(document.getElementById('toolCategory').value);
            const provider = document.getElementById('toolProvider').value;
            const url = document.getElementById('toolURL').value;
            const description = document.getElementById('toolDescription').value;
            const toolType = document.getElementById('toolType').value;
            const sourceType = document.getElementById('toolSource').value;
            const interoperable = document.getElementById('toolInteroperable').value;
            
            try {
                const newTool = await apiRequest('/tools', {
                    method: 'POST',
                    body: JSON.stringify({
                        name: name,
                        category_id: categoryId,
                        provider: provider,
                        url: url,
                        description: description,
                        tool_type: toolType,
                        source_type: sourceType,
                        interoperable: interoperable
                    })
                });
                
                closeModal('addToolModal');
                await loadToolsTable();
                showAlert('Tool added successfully!', 'success');
                
                // Reset form
                event.target.reset();
            } catch (error) {
                showAlert(`Failed to add tool: ${error.message}`, 'error');
            }
        }

        // Search and filter functions
        function filterStages(searchTerm) {
            const rows = document.querySelectorAll('#stagesTableBody tr');
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm.toLowerCase()) ? '' : 'none';
            });
        }

        function filterCategories(searchTerm) {
            const rows = document.querySelectorAll('#categoriesTableBody tr');
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm.toLowerCase()) ? '' : 'none';
            });
        }

        function filterTools(searchTerm) {
            const rows = document.querySelectorAll('#toolsTableBody tr');
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm.toLowerCase()) ? '' : 'none';
            });
        }

        function filterByCategory(categoryName) {
            const rows = document.querySelectorAll('#toolsTableBody tr');
            rows.forEach(row => {
                if (!categoryName) {
                    row.style.display = '';
                } else {
                    const categoryCell = row.cells[1].textContent;
                    row.style.display = categoryCell.includes(categoryName) ? '' : 'none';
                }
            });
        }

        // Edit and delete functions
        function editStage(stageId) {
            showAlert('Edit stage functionality would be implemented with a pre-populated modal', 'info');
        }

        async function deleteStage(stageId) {
            if (confirm('Are you sure you want to delete this stage? This will also delete all associated categories and tools.')) {
                try {
                    await apiRequest(`/stages/${stageId}`, {
                        method: 'DELETE'
                    });
                    
                    await loadStagesTable();
                    await loadStatistics();
                    showAlert('Stage deleted successfully!', 'success');
                } catch (error) {
                    showAlert(`Failed to delete stage: ${error.message}`, 'error');
                }
            }
        }

        function editCategory(categoryId) {
            showAlert('Edit category functionality would be implemented with a pre-populated modal', 'info');
        }

        async function deleteCategory(categoryId) {
            if (confirm('Are you sure you want to delete this category? This will also delete all associated tools.')) {
                try {
                    await apiRequest(`/categories/${categoryId}`, {
                        method: 'DELETE'
                    });
                    
                    await loadCategoriesTable();
                    await loadStatistics();
                    showAlert('Category deleted successfully!', 'success');
                } catch (error) {
                    showAlert(`Failed to delete category: ${error.message}`, 'error');
                }
            }
        }

        function editTool(toolId) {
            showAlert('Edit tool functionality would be implemented with a pre-populated modal', 'info');
        }

        async function deleteTool(toolId) {
            if (confirm('Are you sure you want to delete this tool?')) {
                try {
                    await apiRequest(`/tools/${toolId}`, {
                        method: 'DELETE'
                    });
                    
                    await loadToolsTable();
                    await loadStatistics();
                    showAlert('Tool deleted successfully!', 'success');
                } catch (error) {
                    showAlert(`Failed to delete tool: ${error.message}`, 'error');
                }
            }
        }Category(categoryId) {
            if (confirm('Are you sure you want to delete this category?')) {
                // Find and remove the category
                for (let stage of lifecycleData.stages) {
                    stage.categories = stage.categories.filter(c => c.id !== categoryId);
                }
                loadCategoriesTable();
                showAlert('Category deleted successfully!', 'success');
            }
        }

        function editTool(toolName) {
            showAlert('Edit tool functionality would be implemented here', 'info');
        }

        function deleteTool(toolName) {
            if (confirm('Are you sure you want to delete this tool?')) {
                // Find and remove the tool
                for (let stage of lifecycleData.stages) {
                    for (let category of stage.categories) {
                        category.tools = category.tools.filter(t => t !== toolName);
                    }
                }
                loadToolsTable();
                showAlert('Tool deleted successfully!', 'success');
            }
        }

        // Visualization functions
        function initializeVisualization() {
            const visualizationArea = document.getElementById('visualizationArea');
            visualizationArea.innerHTML = `
                <div style="text-align: center; padding: 50px;">
                    <h3>Interactive Lifecycle Visualization</h3>
                    <p>This would contain an interactive D3.js or similar visualization</p>
                    <p>Showing connections between stages, categories, and tools</p>
                    <div style="margin-top: 30px;">
                        <div style="display: inline-block; margin: 10px; padding: 20px; background: #3498db; color: white; border-radius: 10px;">
                            Conceptualise → Plan → Collect → Process → Analyse → Store
                        </div>
                        <br>
                        <div style="display: inline-block; margin: 10px; padding: 20px; background: #27ae60; color: white; border-radius: 10px;">
                            Publish → Preserve → Share → Access → Transform ↰
                        </div>
                    </div>
                </div>
            `;
        }

        function toggleVisualization(viewType) {
            const visualizationArea = document.getElementById('visualizationArea');
            
            switch(viewType) {
                case 'circular':
                    visualizationArea.innerHTML = '<div style="padding: 50px; text-align: center;"><h3>Circular Visualization</h3><p>Stages arranged in a circle showing the cyclical nature of the research data lifecycle</p></div>';
                    break;
                case 'linear':
                    visualizationArea.innerHTML = '<div style="padding: 50px; text-align: center;"><h3>Linear Visualization</h3><p>Stages arranged in a linear sequence from left to right</p></div>';
                    break;
                case 'network':
                    visualizationArea.innerHTML = '<div style="padding: 50px; text-align: center;"><h3>Network Visualization</h3><p>Interactive network showing relationships between stages, categories, and tools</p></div>';
                    break;
            }
        }

        // Import/Export functions
        function handleFileImport(input) {
            const file = input.files[0];
            if (file) {
                showAlert(`Selected file: ${file.name} (${file.size} bytes)`, 'info');
            }
        }

        async function importData() {
            const fileInput = document.getElementById('importFile');
            const file = fileInput.files[0];
            
            if (!file) {
                showAlert('Please select a file to import', 'error');
                return;
            }
            
            const formData = new FormData();
            formData.append('file', file);
            
            try {
                const response = await fetch(`${API_BASE}/import`, {
                    method: 'POST',
                    body: formData
                });
                
                if (response.ok) {
                    showAlert('Data imported successfully!', 'success');
                    await loadLifecycleData();
                    await loadStatistics();
                } else {
                    const error = await response.json();
                    showAlert(`Import failed: ${error.error}`, 'error');
                }
            } catch (error) {
                showAlert(`Import failed: ${error.message}`, 'error');
            }
        }

        function validateImport() {
            showAlert('Import validation would be performed here', 'info');
        }

        async function exportData() {
            const format = document.getElementById('exportFormat').value;
            
            try {
                const response = await fetch(`${API_BASE}/export/${format}`);
                
                if (response.ok) {
                    if (format === 'json') {
                        const data = await response.json();
                        const dataStr = JSON.stringify(data, null, 2);
                        downloadFile(dataStr, `maldreth_data.${format}`, 'application/json');
                    } else if (format === 'csv') {
                        const csvData = await response.text();
                        downloadFile(csvData, `maldreth_data.${format}`, 'text/csv');
                    }
                    
                    showAlert(`Data exported as ${format.toUpperCase()}`, 'success');
                } else {
                    const error = await response.json();
                    showAlert(`Export failed: ${error.error}`, 'error');
                }
            } catch (error) {
                showAlert(`Export failed: ${error.message}`, 'error');
            }
        }

        function downloadFile(content, filename, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = filename;
            link.click();
            URL.revokeObjectURL(link.href);
        }

        async function exportStages() {
            try {
                const stages = await apiRequest('/stages');
                const stagesData = stages.map(stage => ({
                    name: stage.name,
                    description: stage.description,
                    order: stage.order
                }));
                
                const dataStr = JSON.stringify(stagesData, null, 2);
                downloadFile(dataStr, 'maldreth_stages.json', 'application/json');
                showAlert('Stages exported successfully', 'success');
            } catch (error) {
                showAlert(`Failed to export stages: ${error.message}`, 'error');
            }
        }

        async function exportTools() {
            try {
                const tools = await loadTools();
                const toolsData = tools.map(tool => ({
                    name: tool.name,
                    category: tool.category_name,
                    stage: tool.stage_name,
                    provider: tool.provider,
                    url: tool.url,
                    type: tool.tool_type,
                    source: tool.source_type,
                    scope: tool.scope,
                    interoperable: tool.interoperable
                }));
                
                const dataStr = JSON.stringify(toolsData, null, 2);
                downloadFile(dataStr, 'maldreth_tools.json', 'application/json');
                showAlert('Tools exported successfully', 'success');
            } catch (error) {
                showAlert(`Failed to export tools: ${error.message}`, 'error');
            }
        }

        async function createBackup() {
            try {
                const data = await apiRequest('/lifecycle-data');
                const backupData = {
                    timestamp: new Date().toISOString(),
                    version: '2.0.0',
                    source: 'MaLDReTH Curation Interface',
                    data: data
                };
                
                const dataStr = JSON.stringify(backupData, null, 2);
                downloadFile(dataStr, `maldreth_backup_${new Date().toISOString().split('T')[0]}.json`, 'application/json');
                showAlert('Backup created successfully', 'success');
            } catch (error) {
                showAlert(`Failed to create backup: ${error.message}`, 'error');
            }
        }

        function restoreBackup() {
            showAlert('Backup restoration functionality would be implemented here', 'info');
        }

        function resetDatabase() {
            if (confirm('Are you sure you want to reset the database? This action cannot be undone.')) {
                showAlert('Database reset functionality would be implemented here', 'info');
            }
        }

        // Utility functions
        function showAlert(message, type = 'info') {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.textContent = message;
            alertDiv.style.position = 'fixed';
            alertDiv.style.top = '20px';
            alertDiv.style.right = '20px';
            alertDiv.style.zIndex = '9999';
            alertDiv.style.maxWidth = '400px';
            
            document.body.appendChild(alertDiv);
            
            setTimeout(() => {
                alertDiv.remove();
            }, 5000);
        }

        // Close modals when clicking outside
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', async function() {
            try {
                // Load initial data
                await loadLifecycleData();
                await loadStatistics();
                
                // Load data for the overview tab (default)
                loadTabData('overview');
                
                showAlert('Application loaded successfully', 'success');
            } catch (error) {
                console.error('Failed to initialize application:', error);
                showAlert('Failed to load application data. Please refresh the page.', 'error');
            }
        });
    </script>
</body>
</html>
