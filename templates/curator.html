<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MaLDReTH Curator Interface</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .header {
            background-color: #2c3e50;
            color: white;
            padding: 1rem 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header h1 {
            font-size: 1.8rem;
            font-weight: 600;
        }
        
        .nav-buttons {
            display: flex;
            gap: 1rem;
        }
        
        .nav-buttons a {
            color: white;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        
        .nav-buttons a:hover {
            background-color: rgba(255,255,255,0.1);
        }
        
        .container {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 2rem;
        }
        
        .tabs {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }
        
        .tab-buttons {
            display: flex;
            border-bottom: 1px solid #ddd;
        }
        
        .tab-button {
            padding: 1rem 2rem;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s;
            position: relative;
        }
        
        .tab-button:hover {
            background-color: #f8f9fa;
        }
        
        .tab-button.active {
            color: #3498db;
        }
        
        .tab-button.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            right: 0;
            height: 3px;
            background-color: #3498db;
        }
        
        .tab-content {
            padding: 2rem;
        }
        
        .tab-panel {
            display: none;
        }
        
        .tab-panel.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }
        
        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        
        .form-actions {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }
        
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background-color: #3498db;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #2980b9;
        }
        
        .btn-secondary {
            background-color: #95a5a6;
            color: white;
        }
        
        .btn-secondary:hover {
            background-color: #7f8c8d;
        }
        
        .btn-danger {
            background-color: #e74c3c;
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #c0392b;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .data-table th,
        .data-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        .data-table th {
            background-color: #f8f9fa;
            font-weight: 600;
        }
        
        .data-table tr:hover {
            background-color: #f8f9fa;
        }
        
        .action-buttons {
            display: flex;
            gap: 0.5rem;
        }
        
        .action-buttons button {
            padding: 0.25rem 0.75rem;
            font-size: 0.875rem;
        }
        
        .checkbox-group {
            display: flex;
            gap: 2rem;
            margin-top: 0.5rem;
        }
        
        .checkbox-group label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: normal;
        }
        
        .success-message {
            background-color: #d4edda;
            color: #155724;
            padding: 1rem;
            border-radius: 4px;
            margin-bottom: 1rem;
        }
        
        .error-message {
            background-color: #f8d7da;
            color: #721c24;
            padding: 1rem;
            border-radius: 4px;
            margin-bottom: 1rem;
        }
        
        .log-entry {
            background-color: #f8f9fa;
            padding: 1rem;
            border-radius: 4px;
            margin-bottom: 0.5rem;
        }
        
        .log-entry-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }
        
        .log-entry-date {
            color: #6c757d;
            font-size: 0.875rem;
        }
        
        .loading {
            text-align: center;
            padding: 2rem;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <h1>MaLDReTH Curator Interface</h1>
            <div class="nav-buttons">
                <a href="/">Visualization</a>
                <a href="/curator">Curator Interface</a>
            </div>
        </div>
    </div>

    <div class="container">
        <div id="message-area"></div>
        
        <div class="tabs">
            <div class="tab-buttons">
                <button class="tab-button active" onclick="showTab('tools')">Manage Tools</button>
                <button class="tab-button" onclick="showTab('interactions')">Infrastructure Interactions</button>
                <button class="tab-button" onclick="showTab('categories')">Tool Categories</button>
                <button class="tab-button" onclick="showTab('curation-log')">Curation Log</button>
            </div>
            
            <div class="tab-content">
                <!-- Tools Tab -->
                <div id="tools-tab" class="tab-panel active">
                    <h2>Manage Tools</h2>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="tool-search">Search Tools</label>
                            <input type="text" id="tool-search" placeholder="Search by name, provider, or category...">
                        </div>
                        <div class="form-group">
                            <label for="tool-stage-filter">Filter by Stage</label>
                            <select id="tool-stage-filter">
                                <option value="">All Stages</option>
                            </select>
                        </div>
                    </div>
                    
                    <div id="tools-list" style="margin-top: 2rem;">
                        <div class="loading">Loading tools...</div>
                    </div>
                </div>
                
                <!-- Infrastructure Interactions Tab -->
                <div id="interactions-tab" class="tab-panel">
                    <h2>Infrastructure Interactions</h2>
                    
                    <button class="btn btn-primary" onclick="showAddInteractionForm()">Add New Interaction</button>
                    
                    <div id="interaction-form" style="display: none; margin-top: 2rem;">
                        <h3>Add Infrastructure Interaction</h3>
                        <form onsubmit="saveInteraction(event)">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="from-tool">From Tool</label>
                                    <select id="from-tool" required>
                                        <option value="">Select a tool...</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="to-tool">To Tool</label>
                                    <select id="to-tool" required>
                                        <option value="">Select a tool...</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="interaction-type">Interaction Type</label>
                                <select id="interaction-type" required>
                                    <option value="">Select type...</option>
                                    <option value="data-exchange">Data Exchange</option>
                                    <option value="api-integration">API Integration</option>
                                    <option value="file-transfer">File Transfer</option>
                                    <option value="authentication">Authentication</option>
                                    <option value="workflow">Workflow Integration</option>
                                    <option value="metadata-sync">Metadata Synchronization</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="interaction-description">Description</label>
                                <textarea id="interaction-description" placeholder="Describe how these tools interact..."></textarea>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="data-flow">Data Flow Direction</label>
                                    <select id="data-flow">
                                        <option value="unidirectional">Unidirectional (From → To)</option>
                                        <option value="bidirectional">Bidirectional (From ↔ To)</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="integration-method">Integration Method</label>
                                    <input type="text" id="integration-method" placeholder="e.g., REST API, WebDAV, OAuth2">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>Authentication Required</label>
                                <div class="checkbox-group">
                                    <label>
                                        <input type="checkbox" id="auth-required">
                                        Authentication is required for this interaction
                                    </label>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="curator-name">Your Name</label>
                                    <input type="text" id="curator-name" required>
                                </div>
                                <div class="form-group">
                                    <label for="curator-email">Your Email</label>
                                    <input type="email" id="curator-email" required>
                                </div>
                            </div>
                            
                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary">Save Interaction</button>
                                <button type="button" class="btn btn-secondary" onclick="hideAddInteractionForm()">Cancel</button>
                            </div>
                        </form>
                    </div>
                    
                    <div id="interactions-list" style="margin-top: 2rem;">
                        <div class="loading">Loading interactions...</div>
                    </div>
                </div>
                
                <!-- Categories Tab -->
                <div id="categories-tab" class="tab-panel">
                    <h2>Tool Categories</h2>
                    <p>View and manage tool categories by lifecycle stage.</p>
                    
                    <div id="categories-list">
                        <div class="loading">Loading categories...</div>
                    </div>
                </div>
                
                <!-- Curation Log Tab -->
                <div id="curation-log-tab" class="tab-panel">
                    <h2>Curation Log</h2>
                    <p>View the history of changes made to the infrastructure data.</p>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="log-filter-type">Filter by Type</label>
                            <select id="log-filter-type" onchange="loadCurationLog()">
                                <option value="">All Types</option>
                                <option value="tool">Tools</option>
                                <option value="interaction">Interactions</option>
                                <option value="category">Categories</option>
                            </select>
                        </div>
                    </div>
                    
                    <div id="curation-log-list">
                        <div class="loading">Loading curation log...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let allTools = [];
        let allStages = [];
        
        // Initialize the curator interface
        window.addEventListener('DOMContentLoaded', () => {
            loadStages();
            loadTools();
            loadInteractions();
        });
        
        // Tab switching
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-panel').forEach(panel => {
                panel.classList.remove('active');
            });
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(`${tabName}-tab`).classList.add('active');
            event.target.classList.add('active');
            
            // Load tab-specific data
            switch(tabName) {
                case 'tools':
                    loadTools();
                    break;
                case 'interactions':
                    loadInteractions();
                    break;
                case 'categories':
                    loadCategories();
                    break;
                case 'curation-log':
                    loadCurationLog();
                    break;
            }
        }
        
        // Load stages for filters
        async function loadStages() {
            try {
                const response = await fetch('/api/stages');
                allStages = await response.json();
                
                // Populate stage filter
                const stageFilter = document.getElementById('tool-stage-filter');
                stageFilter.innerHTML = '<option value="">All Stages</option>';
                allStages.forEach(stage => {
                    const option = document.createElement('option');
                    option.value = stage.id;
                    option.textContent = stage.name;
                    stageFilter.appendChild(option);
                });
            } catch (error) {
                console.error('Error loading tool:', error);
                showMessage('Error loading tool details', 'error');
            }
        }
        
        // Update tool
        async function updateTool(event, toolId) {
            event.preventDefault();
            
            const data = {
                name: document.getElementById('edit-name').value,
                provider: document.getElementById('edit-provider').value,
                url: document.getElementById('edit-url').value,
                description: document.getElementById('edit-description').value,
                source_type: document.getElementById('edit-source-type').value,
                scope: document.getElementById('edit-scope').value,
                interoperable: document.getElementById('edit-interoperable').checked,
                api_available: document.getElementById('edit-api-available').checked,
                curator_name: document.getElementById('edit-curator-name').value,
                curator_email: document.getElementById('edit-curator-email').value,
                reason: 'Tool information updated'
            };
            
            try {
                const response = await fetch(`/api/tool/${toolId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (result.status === 'success') {
                    showMessage('Tool updated successfully!', 'success');
                    closeEditForm();
                    loadTools();
                } else {
                    showMessage('Error updating tool', 'error');
                }
            } catch (error) {
                console.error('Error updating tool:', error);
                showMessage('Error updating tool', 'error');
            }
        }
        
        // Close edit form
        function closeEditForm() {
            const overlay = document.getElementById('edit-overlay');
            if (overlay) {
                overlay.remove();
            }
        }
        
        // Load categories
        async function loadCategories() {
            const categoriesList = document.getElementById('categories-list');
            categoriesList.innerHTML = '<div class="loading">Loading categories...</div>';
            
            try {
                const response = await fetch('/api/stages');
                const stages = await response.json();
                
                let html = '';
                for (const stage of stages) {
                    const stageResponse = await fetch(`/api/stage/${stage.id}`);
                    const stageData = await stageResponse.json();
                    
                    html += `<div style="margin-bottom: 2rem;">`;
                    html += `<h3>${stage.name}</h3>`;
                    
                    if (stageData.categories && stageData.categories.length > 0) {
                        html += '<table class="data-table">';
                        html += '<thead><tr><th>Category</th><th>Description</th><th>Tool Count</th></tr></thead>';
                        html += '<tbody>';
                        
                        stageData.categories.forEach(category => {
                            html += '<tr>';
                            html += `<td>${category.category}</td>`;
                            html += `<td>${category.description || 'N/A'}</td>`;
                            html += `<td>${category.tool_count}</td>`;
                            html += '</tr>';
                        });
                        
                        html += '</tbody></table>';
                    } else {
                        html += '<p>No categories found for this stage.</p>';
                    }
                    
                    html += '</div>';
                }
                
                categoriesList.innerHTML = html;
            } catch (error) {
                console.error('Error loading categories:', error);
                categoriesList.innerHTML = '<div class="error">Error loading categories</div>';
            }
        }
        
        // Load curation log
        async function loadCurationLog() {
            const logList = document.getElementById('curation-log-list');
            const filterType = document.getElementById('log-filter-type').value;
            
            try {
                let url = '/api/curation-log';
                if (filterType) {
                    url += `?entity_type=${filterType}`;
                }
                
                const response = await fetch(url);
                const logs = await response.json();
                
                if (logs.length === 0) {
                    logList.innerHTML = '<p>No curation log entries found.</p>';
                    return;
                }
                
                let html = '';
                logs.forEach(log => {
                    html += '<div class="log-entry">';
                    html += '<div class="log-entry-header">';
                    html += `<strong>${log.action} ${log.entity_type}</strong>`;
                    html += `<span class="log-entry-date">${new Date(log.created_at).toLocaleString()}</span>`;
                    html += '</div>';
                    html += `<p>By: ${log.curator_name || 'Unknown'} (${log.curator_email || 'N/A'})</p>`;
                    if (log.reason) {
                        html += `<p>Reason: ${log.reason}</p>`;
                    }
                    html += '</div>';
                });
                
                logList.innerHTML = html;
            } catch (error) {
                console.error('Error loading curation log:', error);
                logList.innerHTML = '<div class="error">Error loading curation log</div>';
            }
        }
        
        // Show message
        function showMessage(message, type) {
            const messageArea = document.getElementById('message-area');
            const messageDiv = document.createElement('div');
            messageDiv.className = type === 'success' ? 'success-message' : 'error-message';
            messageDiv.textContent = message;
            
            messageArea.innerHTML = '';
            messageArea.appendChild(messageDiv);
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                messageDiv.remove();
            }, 5000);
        }
    </script>
</body>
</html>) {
                console.error('Error loading stages:', error);
            }
        }
        
        // Load and display tools
        async function loadTools() {
            try {
                const response = await fetch('/api/tools');
                allTools = await response.json();
                displayTools(allTools);
                
                // Populate tool selects for interactions
                populateToolSelects();
                
                // Setup search and filter listeners
                setupToolFilters();
            } catch (error) {
                console.error('Error loading tools:', error);
                showMessage('Error loading tools', 'error');
            }
        }
        
        // Display tools in table
        function displayTools(tools) {
            const toolsList = document.getElementById('tools-list');
            
            if (tools.length === 0) {
                toolsList.innerHTML = '<p>No tools found.</p>';
                return;
            }
            
            let html = '<table class="data-table">';
            html += '<thead><tr>';
            html += '<th>Name</th>';
            html += '<th>Stage</th>';
            html += '<th>Category</th>';
            html += '<th>Provider</th>';
            html += '<th>Source</th>';
            html += '<th>API</th>';
            html += '<th>Actions</th>';
            html += '</tr></thead>';
            html += '<tbody>';
            
            tools.forEach(tool => {
                html += '<tr>';
                html += `<td>${tool.name}</td>`;
                html += `<td>${tool.stage_name}</td>`;
                html += `<td>${tool.category}</td>`;
                html += `<td>${tool.provider || 'N/A'}</td>`;
                html += `<td>${tool.source_type || 'Unknown'}</td>`;
                html += `<td>${tool.api_available ? '✓' : '✗'}</td>`;
                html += '<td class="action-buttons">';
                html += `<button class="btn btn-primary" onclick="editTool(${tool.id})">Edit</button>`;
                html += '</td>';
                html += '</tr>';
            });
            
            html += '</tbody></table>';
            toolsList.innerHTML = html;
        }
        
        // Setup tool filters
        function setupToolFilters() {
            const searchInput = document.getElementById('tool-search');
            const stageFilter = document.getElementById('tool-stage-filter');
            
            searchInput.addEventListener('input', filterTools);
            stageFilter.addEventListener('change', filterTools);
        }
        
        function filterTools() {
            const searchTerm = document.getElementById('tool-search').value.toLowerCase();
            const stageFilter = document.getElementById('tool-stage-filter').value;
            
            const filteredTools = allTools.filter(tool => {
                const matchesSearch = !searchTerm || 
                    tool.name.toLowerCase().includes(searchTerm) ||
                    (tool.provider && tool.provider.toLowerCase().includes(searchTerm)) ||
                    tool.category.toLowerCase().includes(searchTerm);
                
                const matchesStage = !stageFilter || tool.stage_name === allStages.find(s => s.id == stageFilter)?.name;
                
                return matchesSearch && matchesStage;
            });
            
            displayTools(filteredTools);
        }
        
        // Populate tool selects for interactions
        function populateToolSelects() {
            const fromSelect = document.getElementById('from-tool');
            const toSelect = document.getElementById('to-tool');
            
            // Clear existing options
            fromSelect.innerHTML = '<option value="">Select a tool...</option>';
            toSelect.innerHTML = '<option value="">Select a tool...</option>';
            
            // Group tools by stage
            const toolsByStage = {};
            allTools.forEach(tool => {
                if (!toolsByStage[tool.stage_name]) {
                    toolsByStage[tool.stage_name] = [];
                }
                toolsByStage[tool.stage_name].push(tool);
            });
            
            // Add options grouped by stage
            Object.entries(toolsByStage).forEach(([stageName, tools]) => {
                const optgroup = document.createElement('optgroup');
                optgroup.label = stageName;
                
                tools.forEach(tool => {
                    const option = document.createElement('option');
                    option.value = tool.id;
                    option.textContent = tool.name;
                    optgroup.appendChild(option);
                });
                
                fromSelect.appendChild(optgroup.cloneNode(true));
                toSelect.appendChild(optgroup);
            });
        }
        
        // Show/hide interaction form
        function showAddInteractionForm() {
            document.getElementById('interaction-form').style.display = 'block';
        }
        
        function hideAddInteractionForm() {
            document.getElementById('interaction-form').style.display = 'none';
            document.getElementById('interaction-form').querySelector('form').reset();
        }
        
        // Save interaction
        async function saveInteraction(event) {
            event.preventDefault();
            
            const data = {
                from_tool_id: parseInt(document.getElementById('from-tool').value),
                to_tool_id: parseInt(document.getElementById('to-tool').value),
                interaction_type: document.getElementById('interaction-type').value,
                interaction_description: document.getElementById('interaction-description').value,
                data_flow_direction: document.getElementById('data-flow').value,
                integration_method: document.getElementById('integration-method').value,
                authentication_required: document.getElementById('auth-required').checked,
                curator_name: document.getElementById('curator-name').value,
                curator_email: document.getElementById('curator-email').value
            };
            
            try {
                const response = await fetch('/api/interactions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (result.status === 'success') {
                    showMessage('Interaction added successfully!', 'success');
                    hideAddInteractionForm();
                    loadInteractions();
                } else {
                    showMessage('Error adding interaction: ' + (result.error || 'Unknown error'), 'error');
                }
            } catch (error) {
                console.error('Error saving interaction:', error);
                showMessage('Error saving interaction', 'error');
            }
        }
        
        // Load and display interactions
        async function loadInteractions() {
            try {
                const response = await fetch('/api/interactions');
                const interactions = await response.json();
                displayInteractions(interactions);
            } catch (error) {
                console.error('Error loading interactions:', error);
                showMessage('Error loading interactions', 'error');
            }
        }
        
        // Display interactions
        function displayInteractions(interactions) {
            const interactionsList = document.getElementById('interactions-list');
            
            if (interactions.length === 0) {
                interactionsList.innerHTML = '<p>No infrastructure interactions recorded yet.</p>';
                return;
            }
            
            let html = '<table class="data-table">';
            html += '<thead><tr>';
            html += '<th>From Tool</th>';
            html += '<th>To Tool</th>';
            html += '<th>Type</th>';
            html += '<th>Direction</th>';
            html += '<th>Method</th>';
            html += '<th>Verified</th>';
            html += '<th>Actions</th>';
            html += '</tr></thead>';
            html += '<tbody>';
            
            interactions.forEach(interaction => {
                html += '<tr>';
                html += `<td>${interaction.from_tool_name}</td>`;
                html += `<td>${interaction.to_tool_name}</td>`;
                html += `<td>${interaction.interaction_type}</td>`;
                html += `<td>${interaction.data_flow_direction}</td>`;
                html += `<td>${interaction.integration_method || 'N/A'}</td>`;
                html += `<td>${interaction.verified ? '✓ Verified' : '✗ Not Verified'}</td>`;
                html += '<td class="action-buttons">';
                if (!interaction.verified) {
                    html += `<button class="btn btn-primary" onclick="verifyInteraction(${interaction.id})">Verify</button>`;
                }
                html += `<button class="btn btn-danger" onclick="deleteInteraction(${interaction.id})">Delete</button>`;
                html += '</td>';
                html += '</tr>';
            });
            
            html += '</tbody></table>';
            interactionsList.innerHTML = html;
        }
        
        // Verify interaction
        async function verifyInteraction(interactionId) {
            const verifierName = prompt('Enter your name to verify this interaction:');
            if (!verifierName) return;
            
            try {
                const response = await fetch(`/api/interaction/${interactionId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        verified: true,
                        verified_by: verifierName
                    })
                });
                
                const result = await response.json();
                
                if (result.status === 'success') {
                    showMessage('Interaction verified successfully!', 'success');
                    loadInteractions();
                } else {
                    showMessage('Error verifying interaction', 'error');
                }
            } catch (error) {
                console.error('Error verifying interaction:', error);
                showMessage('Error verifying interaction', 'error');
            }
        }
        
        // Delete interaction
        async function deleteInteraction(interactionId) {
            if (!confirm('Are you sure you want to delete this interaction?')) return;
            
            try {
                const response = await fetch(`/api/interaction/${interactionId}`, {
                    method: 'DELETE'
                });
                
                const result = await response.json();
                
                if (result.status === 'success') {
                    showMessage('Interaction deleted successfully!', 'success');
                    loadInteractions();
                } else {
                    showMessage('Error deleting interaction', 'error');
                }
            } catch (error) {
                console.error('Error deleting interaction:', error);
                showMessage('Error deleting interaction', 'error');
            }
        }
        
        // Edit tool
        async function editTool(toolId) {
            try {
                const response = await fetch(`/api/tool/${toolId}`);
                const tool = await response.json();
                
                // Create edit form in a modal
                const formHtml = `
                    <div style="background: white; padding: 2rem; border-radius: 8px; max-width: 600px; margin: 2rem auto;">
                        <h3>Edit Tool: ${tool.name}</h3>
                        <form onsubmit="updateTool(event, ${toolId})">
                            <div class="form-group">
                                <label>Name</label>
                                <input type="text" id="edit-name" value="${tool.name}" required>
                            </div>
                            <div class="form-group">
                                <label>Provider</label>
                                <input type="text" id="edit-provider" value="${tool.provider || ''}">
                            </div>
                            <div class="form-group">
                                <label>URL</label>
                                <input type="url" id="edit-url" value="${tool.url || ''}">
                            </div>
                            <div class="form-group">
                                <label>Description</label>
                                <textarea id="edit-description">${tool.description || ''}</textarea>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Source Type</label>
                                    <select id="edit-source-type">
                                        <option value="open" ${tool.source_type === 'open' ? 'selected' : ''}>Open</option>
                                        <option value="closed" ${tool.source_type === 'closed' ? 'selected' : ''}>Closed</option>
                                        <option value="freemium" ${tool.source_type === 'freemium' ? 'selected' : ''}>Freemium</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Scope</label>
                                    <select id="edit-scope">
                                        <option value="generic" ${tool.scope === 'generic' ? 'selected' : ''}>Generic</option>
                                        <option value="disciplinary" ${tool.scope === 'disciplinary' ? 'selected' : ''}>Disciplinary</option>
                                        <option value="domain-specific" ${tool.scope === 'domain-specific' ? 'selected' : ''}>Domain-specific</option>
                                    </select>
                                </div>
                            </div>
                            <div class="checkbox-group">
                                <label>
                                    <input type="checkbox" id="edit-interoperable" ${tool.interoperable ? 'checked' : ''}>
                                    Interoperable
                                </label>
                                <label>
                                    <input type="checkbox" id="edit-api-available" ${tool.api_available ? 'checked' : ''}>
                                    API Available
                                </label>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Curator Name</label>
                                    <input type="text" id="edit-curator-name" required>
                                </div>
                                <div class="form-group">
                                    <label>Curator Email</label>
                                    <input type="email" id="edit-curator-email" required>
                                </div>
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary">Save Changes</button>
                                <button type="button" class="btn btn-secondary" onclick="closeEditForm()">Cancel</button>
                            </div>
                        </form>
                    </div>
                `;
                
                // Create overlay
                const overlay = document.createElement('div');
                overlay.id = 'edit-overlay';
                overlay.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; overflow: auto;';
                overlay.innerHTML = formHtml;
                document.body.appendChild(overlay);
                
            } catch (error
